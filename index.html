<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>منصة التعليم الإلكتروني</title>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Cairo', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
            background: rgba(255, 255, 255, 0.95);
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
        }

        .header h1 {
            font-size: 2.5rem;
            font-weight: 700;
            color: #2d3748;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.1rem;
            color: #718096;
        }

        .admin-panel {
            background: rgba(255, 255, 255, 0.95);
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }

        .admin-controls {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            align-items: center;
        }

        /* Added enhanced admin panel styles */
        .admin-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 25px;
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 20px;
            border-radius: 12px;
            text-align: center;
        }

        .stat-number {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 0.9rem;
            opacity: 0.9;
        }

        .admin-section {
            display: none;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        }

        .admin-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .admin-table th,
        .admin-table td {
            padding: 12px;
            text-align: right;
            border-bottom: 1px solid #e2e8f0;
        }

        .admin-table th {
            background: #f7fafc;
            font-weight: 600;
            color: #2d3748;
        }

        .admin-table tr:hover {
            background: #f7fafc;
        }

        .action-btn {
            padding: 6px 12px;
            margin: 0 2px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.8rem;
            transition: all 0.3s ease;
        }

        .action-btn.edit {
            background: #4299e1;
            color: white;
        }

        .action-btn.delete {
            background: #e53e3e;
            color: white;
        }

        .action-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }

        .admin-login {
            background: rgba(255, 255, 255, 0.95);
            padding: 30px;
            border-radius: 20px;
            margin-bottom: 30px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            text-align: center;
        }

        .login-form {
            max-width: 400px;
            margin: 0 auto;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #2d3748;
            text-align: right;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-family: 'Cairo', sans-serif;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 25px;
            border-bottom: 2px solid #e2e8f0;
        }

        .tab {
            padding: 12px 20px;
            background: none;
            border: none;
            cursor: pointer;
            font-weight: 600;
            color: #718096;
            border-bottom: 2px solid transparent;
            transition: all 0.3s ease;
        }

        .tab.active {
            color: #667eea;
            border-bottom-color: #667eea;
        }

        .tab:hover {
            color: #667eea;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            font-family: 'Cairo', sans-serif;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }

        .btn-secondary {
            background: #e2e8f0;
            color: #4a5568;
        }

        .btn-secondary:hover {
            background: #cbd5e0;
        }

        .subjects-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
            margin-bottom: 40px;
        }

        .subject-card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 30px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
        }

        .subject-card:hover {
            transform: translateY(-10px);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15);
        }

        .subject-icon {
            font-size: 3rem;
            margin-bottom: 20px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .subject-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: #2d3748;
            margin-bottom: 10px;
        }

        .subject-description {
            color: #718096;
            font-size: 1rem;
        }

        .teachers-section {
            display: none;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        }

        .teachers-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }

        .teacher-card {
            background: #f7fafc;
            border-radius: 15px;
            padding: 25px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }

        .teacher-card:hover {
            border-color: #667eea;
            transform: translateY(-5px);
        }

        .teacher-avatar {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            margin: 0 auto 15px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 2rem;
            font-weight: 700;
        }

        .teacher-name {
            font-size: 1.2rem;
            font-weight: 600;
            color: #2d3748;
            margin-bottom: 5px;
        }

        .teacher-subject {
            color: #718096;
            font-size: 0.9rem;
        }

        .videos-section {
            display: none;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        }

        .videos-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 25px;
        }

        .video-card {
            background: #f7fafc;
            border-radius: 15px;
            overflow: hidden;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .video-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.15);
        }

        .video-thumbnail {
            width: 100%;
            height: 180px;
            object-fit: cover;
        }

        .video-info {
            padding: 20px;
        }

        .video-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: #2d3748;
            margin-bottom: 8px;
            line-height: 1.4;
        }

        .video-duration {
            color: #718096;
            font-size: 0.9rem;
        }

        .back-btn {
            margin-bottom: 20px;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #718096;
        }

        .loading i {
            font-size: 2rem;
            animation: spin 1s linear infinite;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
        }

        .modal-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            border-radius: 15px;
            padding: 30px;
            max-width: 500px;
            width: 90%;
        }

        .video-player-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.95);
            z-index: 1000;
            backdrop-filter: blur(10px);
        }

        .video-player-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 90%;
            max-width: 1000px;
            background: #1a1a1a;
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.5);
        }

        .video-player-header {
            background: linear-gradient(135deg, #667eea, #764ba2);
            padding: 20px;
            color: white;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .video-player-title {
            font-size: 1.2rem;
            font-weight: 600;
            margin: 0;
            flex: 1;
            margin-right: 20px;
        }

        .video-player-close {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .video-player-close:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: scale(1.1);
        }

        .video-iframe-container {
            position: relative;
            width: 100%;
            height: 0;
            padding-bottom: 56.25%; /* 16:9 aspect ratio */
            background: #000;
        }

        .video-iframe {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border: none;
        }

        .video-player-info {
            padding: 25px;
            background: #2d2d2d;
            color: white;
        }

        .video-info-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .video-info-row:last-child {
            margin-bottom: 0;
        }

        .video-info-label {
            color: #999;
            font-size: 0.9rem;
        }

        .video-info-value {
            color: #fff;
            font-weight: 600;
        }

        .video-controls {
            padding: 20px 25px;
            background: #1a1a1a;
            display: flex;
            gap: 15px;
            justify-content: center;
            border-top: 1px solid #333;
        }

        .video-control-btn {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 25px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .video-control-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }

        .video-control-btn.secondary {
            background: #4a5568;
        }

        .video-control-btn.secondary:hover {
            background: #2d3748;
            box-shadow: 0 10px 20px rgba(74, 85, 104, 0.3);
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .subjects-grid {
                grid-template-columns: 1fr;
            }
            
            .admin-controls {
                justify-content: center;
            }
            
            .video-player-content {
                width: 95%;
                margin: 20px;
            }
            
            .video-player-header {
                padding: 15px;
            }
            
            .video-player-title {
                font-size: 1rem;
            }
            
            .video-player-info {
                padding: 20px;
            }
            
            .video-controls {
                flex-wrap: wrap;
                padding: 15px 20px;
            }
            
            .video-control-btn {
                flex: 1;
                min-width: 120px;
                justify-content: center;
            }
        }

        /* Added advanced features: search, favorites, theme toggle, progress tracking */
        .search-section {
            background: rgba(255, 255, 255, 0.95);
            padding: 25px;
            border-radius: 20px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }

        .search-container {
            display: flex;
            gap: 15px;
            align-items: center;
            flex-wrap: wrap;
        }

        .search-input {
            flex: 1;
            min-width: 300px;
            padding: 15px 20px;
            border: 2px solid #e2e8f0;
            border-radius: 25px;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .search-input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .theme-toggle {
            position: fixed;
            top: 20px;
            left: 20px;
            z-index: 999;
            background: rgba(255, 255, 255, 0.9);
            border: none;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .theme-toggle:hover {
            transform: scale(1.1);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        }

        .favorites-section {
            display: none;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        }

        .progress-bar {
            width: 100%;
            height: 6px;
            background: #e2e8f0;
            border-radius: 3px;
            overflow: hidden;
            margin-top: 10px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea, #764ba2);
            border-radius: 3px;
            transition: width 0.3s ease;
        }

        .floating-menu {
            position: fixed;
            bottom: 30px;
            right: 30px;
            z-index: 998;
        }

        .floating-btn {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.3);
            transition: all 0.3s ease;
            margin-bottom: 15px;
        }

        .floating-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 15px 40px rgba(102, 126, 234, 0.4);
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1001;
            background: #4caf50;
            color: white;
            padding: 15px 20px;
            border-radius: 10px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            transform: translateX(400px);
            transition: transform 0.3s ease;
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification.error {
            background: #f44336;
        }

        .notification.warning {
            background: #ff9800;
        }

        .skeleton {
            background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
            background-size: 200% 100%;
            animation: loading 1.5s infinite;
        }

        @keyframes loading {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }

        .offline-indicator {
            position: fixed;
            bottom: 20px;
            left: 20px;
            background: #f44336;
            color: white;
            padding: 10px 15px;
            border-radius: 25px;
            font-size: 0.9rem;
            display: none;
            z-index: 999;
        }

        .stats-widget {
            background: rgba(255, 255, 255, 0.95);
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .achievement-badge {
            display: inline-block;
            background: linear-gradient(135deg, #ffd700, #ffed4e);
            color: #333;
            padding: 5px 12px;
            border-radius: 15px;
            font-size: 0.8rem;
            font-weight: 600;
            margin: 2px;
        }

        /* Dark theme styles */
        body.dark-theme {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: #e2e8f0;
        }

        body.dark-theme .header,
        body.dark-theme .admin-panel,
        body.dark-theme .subject-card,
        body.dark-theme .teachers-section,
        body.dark-theme .videos-section,
        body.dark-theme .search-section,
        body.dark-theme .favorites-section,
        body.dark-theme .admin-section,
        body.dark-theme .stats-widget {
            background: rgba(45, 55, 72, 0.95);
            color: #e2e8f0;
        }

        body.dark-theme .teacher-card,
        body.dark-theme .video-card {
            background: #2d3748;
            color: #e2e8f0;
        }

        body.dark-theme .admin-table th {
            background: #2d3748;
            color: #e2e8f0;
        }

        body.dark-theme .form-group input,
        body.dark-theme .form-group select,
        body.dark-theme .form-group textarea,
        body.dark-theme .search-input {
            background: #2d3748;
            color: #e2e8f0;
            border-color: #4a5568;
        }

        @media (max-width: 768px) {
            .search-container {
                flex-direction: column;
            }
            
            .search-input {
                min-width: 100%;
            }
            
            .floating-menu {
                bottom: 20px;
                right: 20px;
            }
            
            .theme-toggle {
                top: 15px;
                left: 15px;
                width: 45px;
                height: 45px;
            }
        }

        /* Enhanced animations and micro-interactions */
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .animate-fade-in {
            animation: fadeInUp 0.6s ease-out;
        }

        .animate-pulse {
            animation: pulse 2s infinite;
        }

        .video-card:hover .video-thumbnail {
            transform: scale(1.05);
            transition: transform 0.3s ease;
        }

        .subject-card:hover .subject-icon {
            animation: pulse 1s ease-in-out;
        }
    </style>
</head>
<body>
    <!-- Added theme toggle button -->
    <button class="theme-toggle" onclick="toggleTheme()" title="تبديل المظهر">
        <i id="theme-icon" class="fas fa-moon"></i>
    </button>

    <!-- Added offline indicator -->
    <div id="offline-indicator" class="offline-indicator">
        <i class="fas fa-wifi"></i> غير متصل بالإنترنت
    </div>

    <!-- Added notification system -->
    <div id="notification" class="notification">
        <span id="notification-text"></span>
    </div>

    <div class="container">
        <div class="header animate-fade-in">
            <h1><i class="fas fa-graduation-cap"></i> منصة التعليم الإلكتروني</h1>
            <p>تعلم مع أفضل المدرسين في جميع المواد الدراسية</p>
        </div>

        <!-- Added global search section -->
        <div id="search-section" class="search-section animate-fade-in">
            <div class="search-container">
                <input type="text" id="global-search" class="search-input" 
                       placeholder="ابحث عن فيديوهات، مدرسين، أو مواضيع...">
                <button class="btn btn-primary" onclick="performGlobalSearch()">
                    <i class="fas fa-search"></i> بحث
                </button>
                <button class="btn btn-secondary" onclick="showFavorites()">
                    <i class="fas fa-heart"></i> المفضلة (<span id="favorites-count">0</span>)
                </button>
            </div>
        </div>

        <!-- Added user stats widget -->
        <div id="user-stats" class="stats-widget animate-fade-in">
            <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 15px;">
                <div>
                    <h4 style="margin-bottom: 10px; color: #2d3748;">إحصائياتك</h4>
                    <div style="display: flex; gap: 20px; flex-wrap: wrap;">
                        <span><i class="fas fa-play-circle" style="color: #667eea;"></i> <span id="user-videos-watched">0</span> فيديو</span>
                        <span><i class="fas fa-clock" style="color: #667eea;"></i> <span id="user-time-spent">0</span> دقيقة</span>
                        <span><i class="fas fa-trophy" style="color: #ffd700;"></i> <span id="user-achievements">0</span> إنجاز</span>
                    </div>
                </div>
                <div id="user-badges"></div>
            </div>
            <div class="progress-bar">
                <div id="daily-progress" class="progress-fill" style="width: 0%"></div>
            </div>
            <p style="font-size: 0.9rem; color: #718096; margin-top: 5px;">التقدم اليومي: <span id="daily-goal">0/30</span> دقيقة</p>
        </div>

        <!-- Admin Login -->
        <div id="admin-login" class="admin-login">
            <h2 style="margin-bottom: 20px; color: #2d3748;">تسجيل دخول المدير</h2>
            <div class="login-form">
                <div class="form-group">
                    <label>كلمة المرور</label>
                    <input type="password" id="admin-password" placeholder="أدخل كلمة مرور المدير">
                </div>
                <button class="btn btn-primary" onclick="adminLogin()">
                    <i class="fas fa-sign-in-alt"></i> دخول
                </button>
            </div>
        </div>

        <!-- Admin Panel -->
        <div id="admin-panel" class="admin-panel" style="display: none;">
            <div class="admin-stats">
                <div class="stat-card">
                    <div id="total-teachers" class="stat-number">0</div>
                    <div class="stat-label">إجمالي المدرسين</div>
                </div>
                <div class="stat-card">
                    <div id="total-videos" class="stat-number">0</div>
                    <div class="stat-label">إجمالي الفيديوهات</div>
                </div>
                <div class="stat-card">
                    <div id="total-subjects" class="stat-number">5</div>
                    <div class="stat-label">المواد المتاحة</div>
                </div>
                <div class="stat-card">
                    <div id="total-views" class="stat-number">0</div>
                    <div class="stat-label">المشاهدات</div>
                </div>
            </div>

            <div class="tabs">
                <button class="tab active" onclick="showAdminTab('overview')">نظرة عامة</button>
                <button class="tab" onclick="showAdminTab('teachers')">إدارة المدرسين</button>
                <button class="tab" onclick="showAdminTab('analytics')">التحليلات</button>
                <button class="tab" onclick="showAdminTab('settings')">الإعدادات</button>
            </div>

            <div class="admin-controls">
                <button class="btn btn-primary" onclick="showAddTeacherModal()">
                    <i class="fas fa-plus"></i> إضافة مدرس جديد
                </button>
                <button class="btn btn-secondary" onclick="refreshData()">
                    <i class="fas fa-sync"></i> تحديث البيانات
                </button>
                <button class="btn btn-secondary" onclick="exportData()">
                    <i class="fas fa-download"></i> تصدير البيانات
                </button>
                <button class="btn btn-secondary" onclick="adminLogout()" style="margin-right: auto;">
                    <i class="fas fa-sign-out-alt"></i> تسجيل خروج
                </button>
            </div>
        </div>

        <!-- Admin Sections -->
        <div id="admin-overview" class="admin-section">
            <h3 style="margin-bottom: 20px; color: #2d3748;">نظرة عامة على النظام</h3>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px;">
                <div style="background: #f7fafc; padding: 20px; border-radius: 12px;">
                    <h4 style="color: #2d3748; margin-bottom: 15px;">آخر النشاطات</h4>
                    <div id="recent-activities">
                        <p style="color: #718096;">لا توجد أنشطة حديثة</p>
                    </div>
                </div>
                <div style="background: #f7fafc; padding: 20px; border-radius: 12px;">
                    <h4 style="color: #2d3748; margin-bottom: 15px;">المدرسون الأكثر نشاطاً</h4>
                    <div id="top-teachers">
                        <p style="color: #718096;">جاري تحميل البيانات...</p>
                    </div>
                </div>
            </div>
        </div>

        <div id="admin-teachers" class="admin-section">
            <h3 style="margin-bottom: 20px; color: #2d3748;">إدارة المدرسين</h3>
            <div style="margin-bottom: 20px;">
                <input type="text" id="teacher-search" placeholder="البحث عن مدرس..." 
                       style="padding: 10px; border: 2px solid #e2e8f0; border-radius: 8px; width: 300px;">
                <select id="subject-filter" style="padding: 10px; border: 2px solid #e2e8f0; border-radius: 8px; margin-right: 10px;">
                    <option value="">جميع المواد</option>
                    <option value="chemistry">الكيمياء</option>
                    <option value="physics">الفيزياء</option>
                    <option value="biology">الأحياء</option>
                    <option value="english">اللغة الإنجليزية</option>
                    <option value="arabic">اللغة العربية</option>
                </select>
            </div>
            <table id="teachers-table" class="admin-table">
                <thead>
                    <tr>
                        <th>الإجراءات</th>
                        <th>الوصف</th>
                        <th>المادة</th>
                        <th>اسم المدرس</th>
                    </tr>
                </thead>
                <tbody id="teachers-table-body">
                    <tr>
                        <td colspan="4" style="text-align: center; color: #718096;">جاري تحميل البيانات...</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <div id="admin-analytics" class="admin-section">
            <h3 style="margin-bottom: 20px; color: #2d3748;">التحليلات والإحصائيات</h3>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px;">
                <div style="background: #f7fafc; padding: 20px; border-radius: 12px;">
                    <h4 style="color: #2d3748; margin-bottom: 15px;">المواد الأكثر شعبية</h4>
                    <div id="popular-subjects">
                        <div style="margin-bottom: 10px;">
                            <div style="display: flex; justify-content: space-between;">
                                <span>الكيمياء</span>
                                <span>45%</span>
                            </div>
                            <div style="background: #e2e8f0; height: 8px; border-radius: 4px; margin-top: 5px;">
                                <div style="background: #667eea; height: 100%; width: 45%; border-radius: 4px;"></div>
                            </div>
                        </div>
                        <div style="margin-bottom: 10px;">
                            <div style="display: flex; justify-content: space-between;">
                                <span>الفيزياء</span>
                                <span>30%</span>
                            </div>
                            <div style="background: #e2e8f0; height: 8px; border-radius: 4px; margin-top: 5px;">
                                <div style="background: #667eea; height: 100%; width: 30%; border-radius: 4px;"></div>
                            </div>
                        </div>
                        <div style="margin-bottom: 10px;">
                            <div style="display: flex; justify-content: space-between;">
                                <span>الأحياء</span>
                                <span>25%</span>
                            </div>
                            <div style="background: #e2e8f0; height: 8px; border-radius: 4px; margin-top: 5px;">
                                <div style="background: #667eea; height: 100%; width: 25%; border-radius: 4px;"></div>
                            </div>
                        </div>
                    </div>
                </div>
                <div style="background: #f7fafc; padding: 20px; border-radius: 12px;">
                    <h4 style="color: #2d3748; margin-bottom: 15px;">إحصائيات الاستخدام</h4>
                    <div id="usage-stats">
                        <p style="margin-bottom: 10px;"><strong>الزيارات اليومية:</strong> <span style="color: #667eea;">1,234</span></p>
                        <p style="margin-bottom: 10px;"><strong>المستخدمون النشطون:</strong> <span style="color: #667eea;">456</span></p>
                        <p style="margin-bottom: 10px;"><strong>متوسط وقت المشاهدة:</strong> <span style="color: #667eea;">15 دقيقة</span></p>
                        <p style="margin-bottom: 10px;"><strong>معدل الإكمال:</strong> <span style="color: #667eea;">78%</span></p>
                    </div>
                </div>
            </div>
        </div>

        <div id="admin-settings" class="admin-section">
            <h3 style="margin-bottom: 20px; color: #2d3748;">إعدادات النظام</h3>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px;">
                <div style="background: #f7fafc; padding: 20px; border-radius: 12px;">
                    <h4 style="color: #2d3748; margin-bottom: 15px;">إعدادات عامة</h4>
                    <div class="form-group">
                        <label>اسم المنصة</label>
                        <input type="text" value="منصة التعليم الإلكتروني" id="platform-name">
                    </div>
                    <div class="form-group">
                        <label>وصف المنصة</label>
                        <textarea id="platform-description" rows="3">تعلم مع أفضل المدرسين في جميع المواد الدراسية</textarea>
                    </div>
                    <button class="btn btn-primary" onclick="saveSettings()">حفظ الإعدادات</button>
                </div>
                <div style="background: #f7fafc; padding: 20px; border-radius: 12px;">
                    <h4 style="color: #2d3748; margin-bottom: 15px;">إعدادات الأمان</h4>
                    <div class="form-group">
                        <label>كلمة مرور المدير الجديدة</label>
                        <input type="password" id="new-admin-password" placeholder="اتركها فارغة للاحتفاظ بالحالية">
                    </div>
                    <div class="form-group">
                        <label>تأكيد كلمة المرور</label>
                        <input type="password" id="confirm-admin-password">
                    </div>
                    <button class="btn btn-primary" onclick="changeAdminPassword()">تغيير كلمة المرور</button>
                </div>
            </div>
        </div>

        <!-- Subjects Section -->
        <div id="subjects-section">
            <div class="subjects-grid">
                <div class="subject-card" onclick="showTeachers('chemistry')">
                    <div class="subject-icon">
                        <i class="fas fa-flask"></i>
                    </div>
                    <div class="subject-title">الكيمياء</div>
                    <div class="subject-description">تعلم أساسيات الكيمياء والتفاعلات الكيميائية</div>
                </div>

                <div class="subject-card" onclick="showTeachers('physics')">
                    <div class="subject-icon">
                        <i class="fas fa-atom"></i>
                    </div>
                    <div class="subject-title">الفيزياء</div>
                    <div class="subject-description">اكتشف قوانين الطبيعة والظواهر الفيزيائية</div>
                </div>

                <div class="subject-card" onclick="showTeachers('biology')">
                    <div class="subject-icon">
                        <i class="fas fa-dna"></i>
                    </div>
                    <div class="subject-title">الأحياء</div>
                    <div class="subject-description">استكشف عالم الكائنات الحية والطبيعة</div>
                </div>

                <div class="subject-card" onclick="showTeachers('english')">
                    <div class="subject-icon">
                        <i class="fas fa-language"></i>
                    </div>
                    <div class="subject-title">اللغة الإنجليزية</div>
                    <div class="subject-description">تطوير مهارات اللغة الإنجليزية والتواصل</div>
                </div>

                <div class="subject-card" onclick="showTeachers('arabic')">
                    <div class="subject-icon">
                        <i class="fas fa-book"></i>
                    </div>
                    <div class="subject-title">اللغة العربية</div>
                    <div class="subject-description">إتقان قواعد اللغة العربية والأدب</div>
                </div>
            </div>
        </div>

        <!-- Teachers Section -->
        <div id="teachers-section" class="teachers-section">
            <button class="btn btn-secondary back-btn" onclick="showSubjects()">
                <i class="fas fa-arrow-right"></i> العودة للمواد
            </button>
            <h2 id="subject-title" style="margin-bottom: 25px; color: #2d3748;"></h2>
            <div id="teachers-grid" class="teachers-grid"></div>
        </div>

        <!-- Videos Section -->
        <div id="videos-section" class="videos-section">
            <button class="btn btn-secondary back-btn" onclick="showTeachers()">
                <i class="fas fa-arrow-right"></i> العودة للمدرسين
            </button>
            <h2 id="teacher-title" style="margin-bottom: 25px; color: #2d3748;"></h2>
            <div id="videos-grid" class="videos-grid"></div>
        </div>

        <!-- Added favorites section -->
        <div id="favorites-section" class="favorites-section">
            <button class="btn btn-secondary back-btn" onclick="hideFavorites()">
                <i class="fas fa-arrow-right"></i> العودة
            </button>
            <h2 style="margin-bottom: 25px; color: #2d3748;">
                <i class="fas fa-heart" style="color: #e53e3e;"></i> الفيديوهات المفضلة
            </h2>
            <div id="favorites-grid" class="videos-grid"></div>
        </div>
    </div>

    <!-- Added floating action menu -->
    <div class="floating-menu">
        <button class="floating-btn" onclick="scrollToTop()" title="العودة للأعلى">
            <i class="fas fa-arrow-up"></i>
        </button>
        <button class="floating-btn" onclick="showQuickStats()" title="الإحصائيات السريعة">
            <i class="fas fa-chart-line"></i>
        </button>
        <button class="floating-btn" onclick="showHelp()" title="المساعدة">
            <i class="fas fa-question"></i>
        </button>
    </div>

    <!-- Add Teacher Modal -->
    <div id="add-teacher-modal" class="modal">
        <div class="modal-content">
            <h3 style="margin-bottom: 20px; color: #2d3748;">إضافة مدرس جديد</h3>
            <form id="add-teacher-form">
                <div class="form-group">
                    <label>اسم المدرس</label>
                    <input type="text" id="teacher-name" required>
                </div>
                <div class="form-group">
                    <label>المادة</label>
                    <select id="teacher-subject" required>
                        <option value="">اختر المادة</option>
                        <option value="chemistry">الكيمياء</option>
                        <option value="physics">الفيزياء</option>
                        <option value="biology">الأحياء</option>
                        <option value="english">اللغة الإنجليزية</option>
                        <option value="arabic">اللغة العربية</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>رابط القائمة (Playlist URL)</label>
                    <input type="url" id="playlist-url" required>
                </div>
                <div class="form-group">
                    <label>وصف المدرس</label>
                    <textarea id="teacher-description" rows="3"></textarea>
                </div>
                <div style="display: flex; gap: 10px; justify-content: flex-end;">
                    <button type="button" class="btn btn-secondary" onclick="closeModal()">إلغاء</button>
                    <button type="submit" class="btn btn-primary">إضافة المدرس</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Video Player Modal -->
    <div id="video-player-modal" class="video-player-modal">
        <div class="video-player-content">
            <div class="video-player-header">
                <h3 id="video-player-title" class="video-player-title">عنوان الفيديو</h3>
                <button class="video-player-close" onclick="closeVideoPlayer()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="video-iframe-container">
                <iframe id="video-iframe" class="video-iframe" 
                        src="" 
                        allowfullscreen>
                </iframe>
            </div>
            
            <div class="video-player-info">
                <div class="video-info-row">
                    <span class="video-info-label">المدرس:</span>
                    <span id="video-teacher-name" class="video-info-value">اسم المدرس</span>
                </div>
                <div class="video-info-row">
                    <span class="video-info-label">المادة:</span>
                    <span id="video-subject-name" class="video-info-value">اسم المادة</span>
                </div>
                <div class="video-info-row">
                    <span class="video-info-label">القائمة:</span>
                    <span id="video-playlist-name" class="video-info-value">اسم القائمة</span>
                </div>
            </div>
            
            <div class="video-controls">
                <button class="video-control-btn" onclick="openInYouTube()">
                    <i class="fab fa-youtube"></i>
                    فتح في يوتيوب
                </button>
                <button class="video-control-btn secondary" onclick="shareVideo()">
                    <i class="fas fa-share"></i>
                    مشاركة
                </button>
                <button class="video-control-btn secondary" onclick="addToFavorites()">
                    <i class="fas fa-heart"></i>
                    إضافة للمفضلة
                </button>
            </div>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>

    <script>
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyBpPauoZKrirkYeyPjrBXMq_wPJ4l20YoM",
            authDomain: "study-974f5.firebaseapp.com",
            projectId: "study-974f5",
            storageBucket: "study-974f5.firebasestorage.app",
            messagingSenderId: "751371334033",
            appId: "1:751371334033:web:daf64de0d43910668faa30",
            measurementId: "G-MBGG2X56LK"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        // YouTube API Configuration
        const YOUTUBE_API_KEY = 'AIzaSyA7TYBY-o0aIhZbZuzn_WJAjNht0F4YGH0';

        /* Added admin authentication and enhanced functionality */
        const ADMIN_PASSWORD = 'admin123'; // In production, this should be hashed and stored securely
        let isAdminLoggedIn = false;
        let allTeachers = [];
        let currentAdminTab = 'overview';

        let currentSubject = '';
        let currentTeacher = null;
        let currentVideo = null;

        /* Added admin authentication functions */
        function adminLogin() {
            const password = document.getElementById('admin-password').value;
            if (password === ADMIN_PASSWORD) {
                isAdminLoggedIn = true;
                document.getElementById('admin-login').style.display = 'none';
                document.getElementById('admin-panel').style.display = 'block';
                showAdminTab('overview');
                loadAdminData();
                document.getElementById('admin-password').value = '';
            } else {
                alert('كلمة المرور غير صحيحة');
            }
        }

        function adminLogout() {
            isAdminLoggedIn = false;
            document.getElementById('admin-login').style.display = 'block';
            document.getElementById('admin-panel').style.display = 'none';
            hideAllAdminSections();
        }

        function showAdminTab(tab) {
            // Update tab buttons
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            event?.target?.classList.add('active');
            
            // Hide all sections
            hideAllAdminSections();
            
            // Show selected section
            document.getElementById(`admin-${tab}`).style.display = 'block';
            currentAdminTab = tab;
            
            // Load specific data for the tab
            if (tab === 'teachers') {
                loadTeachersTable();
            } else if (tab === 'analytics') {
                loadAnalytics();
            }
        }

        function hideAllAdminSections() {
            document.querySelectorAll('.admin-section').forEach(section => {
                section.style.display = 'none';
            });
        }

        async function loadAdminData() {
            try {
                // Load statistics
                const teachersSnapshot = await db.collection('teachers').get();
                const totalTeachers = teachersSnapshot.size;
                
                let totalVideos = 0;
                teachersSnapshot.forEach(doc => {
                    const teacher = doc.data();
                    if (teacher.playlists) {
                        totalVideos += teacher.playlists.length * 10; // Estimate
                    }
                    if (teacher.videoId) {
                        totalVideos += 1;
                    }
                });

                document.getElementById('total-teachers').textContent = totalTeachers;
                document.getElementById('total-videos').textContent = totalVideos;
                
                // Load views from localStorage
                const views = localStorage.getItem('totalViews') || '0';
                document.getElementById('total-views').textContent = views;

                // Store teachers data
                allTeachers = [];
                teachersSnapshot.forEach(doc => {
                    allTeachers.push({ id: doc.id, ...doc.data() });
                });

            } catch (error) {
                console.error('[v0] Error loading admin data:', error);
            }
        }

        async function loadTeachersTable() {
            const tbody = document.getElementById('teachers-table-body');
            tbody.innerHTML = '<tr><td colspan="4" style="text-align: center;">جاري تحميل البيانات...</td></tr>';

            try {
                const snapshot = await db.collection('teachers').get();
                tbody.innerHTML = '';

                if (snapshot.empty) {
                    tbody.innerHTML = '<tr><td colspan="4" style="text-align: center; color: #718096;">لا يوجد مدرسون</td></tr>';
                    return;
                }

                const subjectNames = {
                    chemistry: 'الكيمياء',
                    physics: 'الفيزياء',
                    biology: 'الأحياء',
                    english: 'اللغة الإنجليزية',
                    arabic: 'اللغة العربية'
                };

                snapshot.forEach(doc => {
                    const teacher = doc.data();
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>
                            <button class="action-btn edit" onclick="editTeacher('${doc.id}')">
                                <i class="fas fa-edit"></i> تعديل
                            </button>
                            <button class="action-btn delete" onclick="deleteTeacher('${doc.id}')">
                                <i class="fas fa-trash"></i> حذف
                            </button>
                        </td>
                        <td>${teacher.description || 'لا يوجد وصف'}</td>
                        <td>${subjectNames[teacher.subject] || teacher.subject}</td>
                        <td>${teacher.name}</td>
                    `;
                    tbody.appendChild(row);
                });

            } catch (error) {
                console.error('[v0] Error loading teachers table:', error);
                tbody.innerHTML = '<tr><td colspan="4" style="text-align: center; color: #e53e3e;">حدث خطأ في تحميل البيانات</td></tr>';
            }
        }

        async function deleteTeacher(teacherId) {
            if (confirm('هل أنت متأكد من حذف هذا المدرس؟')) {
                try {
                    await db.collection('teachers').doc(teacherId).delete();
                    alert('تم حذف المدرس بنجاح');
                    loadTeachersTable();
                    loadAdminData();
                } catch (error) {
                    console.error('[v0] Error deleting teacher:', error);
                    alert('حدث خطأ في حذف المدرس');
                }
            }
        }

        function editTeacher(teacherId) {
            // For now, just show an alert. In a full implementation, this would open an edit modal
            alert('ميزة التعديل ستكون متاحة قريباً');
        }

        function loadAnalytics() {
            // Simulate loading analytics data
            console.log('[v0] Loading analytics data');
        }

        function exportData() {
            // Export teachers data as JSON
            const dataStr = JSON.stringify(allTeachers, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = 'teachers-data.json';
            link.click();
            URL.revokeObjectURL(url);
        }

        function saveSettings() {
            const platformName = document.getElementById('platform-name').value;
            const platformDescription = document.getElementById('platform-description').value;
            
            // Save to localStorage for now
            localStorage.setItem('platformName', platformName);
            localStorage.setItem('platformDescription', platformDescription);
            
            // Update the header
            document.querySelector('.header h1').innerHTML = `<i class="fas fa-graduation-cap"></i> ${platformName}`;
            document.querySelector('.header p').textContent = platformDescription;
            
            alert('تم حفظ الإعدادات بنجاح');
        }

        function changeAdminPassword() {
            const newPassword = document.getElementById('new-admin-password').value;
            const confirmPassword = document.getElementById('confirm-admin-password').value;
            
            if (!newPassword) {
                alert('يرجى إدخال كلمة المرور الجديدة');
                return;
            }
            
            if (newPassword !== confirmPassword) {
                alert('كلمات المرور غير متطابقة');
                return;
            }
            
            // In a real application, this would be handled securely on the server
            alert('تم تغيير كلمة المرور بنجاح (ملاحظة: في التطبيق الحقيقي، يجب تشفير كلمة المرور)');
            document.getElementById('new-admin-password').value = '';
            document.getElementById('confirm-admin-password').value = '';
        }

        /* Enhanced video tracking */
        function openVideoPlayer(video, videoId) {
            currentVideo = { ...video, videoId };
            
            // Track video views
            let totalViews = parseInt(localStorage.getItem('totalViews') || '0');
            totalViews++;
            localStorage.setItem('totalViews', totalViews.toString());
            
            const modal = document.getElementById('video-player-modal');
            const iframe = document.getElementById('video-iframe');
            const title = document.getElementById('video-player-title');
            const teacherName = document.getElementById('video-teacher-name');
            const subjectName = document.getElementById('video-subject-name');
            const playlistName = document.getElementById('video-playlist-name');
            
            // Set video details
            title.textContent = video.snippet.title;
            teacherName.textContent = currentTeacher?.name || 'غير محدد';
            
            const subjectNames = {
                chemistry: 'الكيمياء',
                physics: 'الفيزياء',
                biology: 'الأحياء',
                english: 'اللغة الإنجليزية',
                arabic: 'اللغة العربية'
            };
            subjectName.textContent = subjectNames[currentSubject] || 'غير محدد';
            playlistName.textContent = video.playlistTitle || 'فيديو منفرد';
            
            // Set iframe source with autoplay
            iframe.src = `https://www.youtube.com/embed/${videoId}?autoplay=1&rel=0&modestbranding=1`;
            
            // Show modal
            modal.style.display = 'block';
            document.body.style.overflow = 'hidden'; // Prevent background scrolling
        }

        function closeVideoPlayer() {
            const modal = document.getElementById('video-player-modal');
            const iframe = document.getElementById('video-iframe');
            
            // Stop video by clearing src
            iframe.src = '';
            modal.style.display = 'none';
            document.body.style.overflow = 'auto'; // Restore scrolling
            currentVideo = null;
        }

        function openInYouTube() {
            if (currentVideo) {
                window.open(`https://www.youtube.com/watch?v=${currentVideo.videoId}`, '_blank');
            }
        }

        function shareVideo() {
            if (currentVideo) {
                const shareUrl = `https://www.youtube.com/watch?v=${currentVideo.videoId}`;
                if (navigator.share) {
                    navigator.share({
                        title: currentVideo.snippet.title,
                        text: `شاهد هذا الفيديو من ${currentTeacher?.name}`,
                        url: shareUrl
                    });
                } else {
                    // Fallback: copy to clipboard
                    navigator.clipboard.writeText(shareUrl).then(() => {
                        alert('تم نسخ رابط الفيديو!');
                    });
                }
            }
        }

        function addToFavorites() {
            if (currentVideo) {
                // Store in localStorage for now
                const favorites = JSON.parse(localStorage.getItem('favorites') || '[]');
                const favorite = {
                    videoId: currentVideo.videoId,
                    title: currentVideo.snippet.title,
                    teacher: currentTeacher?.name,
                    subject: currentSubject,
                    thumbnail: currentVideo.snippet.thumbnails.medium?.url,
                    addedAt: new Date().toISOString()
                };
                
                // Check if already in favorites
                if (!favorites.find(f => f.videoId === favorite.videoId)) {
                    favorites.push(favorite);
                    localStorage.setItem('favorites', JSON.stringify(favorites));
                    alert('تم إضافة الفيديو للمفضلة!');
                } else {
                    alert('الفيديو موجود بالفعل في المفضلة!');
                }
            }
        }

        // Admin Functions
        function showAddTeacherModal() {
            document.getElementById('add-teacher-modal').style.display = 'block';
        }

        function closeModal() {
            document.getElementById('add-teacher-modal').style.display = 'none';
            document.getElementById('add-teacher-form').reset();
        }

        async function refreshData() {
            if (currentSubject) {
                await showTeachers(currentSubject);
            }
        }

        function showStats() {
            alert('الإحصائيات ستكون متاحة قريباً');
        }

        // Form submission
        document.getElementById('add-teacher-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const name = document.getElementById('teacher-name').value;
            const subject = document.getElementById('teacher-subject').value;
            const playlistUrl = document.getElementById('playlist-url').value;
            const description = document.getElementById('teacher-description').value;

            try {
                // Extract playlist ID from URL
                const playlistId = extractPlaylistId(playlistUrl);
                
                const teacherData = {
                    name,
                    subject,
                    playlists: [{
                        title: 'قائمة التشغيل الرئيسية',
                        url: playlistUrl,
                        id: playlistId
                    }],
                    description: description || 'مدرس متميز'
                };

                await db.collection('teachers').add(teacherData);
                alert('تم إضافة المدرس بنجاح!');
                closeModal();
                
                if (currentSubject === subject) {
                    await showTeachers(subject);
                }
            } catch (error) {
                console.error('[v0] Error adding teacher:', error);
                alert('حدث خطأ في إضافة المدرس');
            }
        });

        function extractPlaylistId(url) {
            const match = url.match(/[?&]list=([^&]+)/);
            return match ? match[1] : '';
        }

        // Close modal when clicking outside
        window.onclick = function(event) {
            const modal = document.getElementById('add-teacher-modal');
            const videoModal = document.getElementById('video-player-modal');
            
            if (event.target === modal) {
                closeModal();
            } else if (event.target === videoModal) {
                closeVideoPlayer();
            }
        }

        // Keyboard controls for video player
        document.addEventListener('keydown', function(event) {
            const videoModal = document.getElementById('video-player-modal');
            if (videoModal.style.display === 'block') {
                if (event.key === 'Escape') {
                    closeVideoPlayer();
                } else if (event.key === 'f' || event.key === 'F') {
                    // Toggle fullscreen (handled by YouTube player)
                    event.preventDefault();
                }
            }
        });

         
        async function initializeDefaultData() {
            try {
                for (const [subject, teachers] of Object.entries(defaultTeachers)) {
                    for (const teacher of teachers) {
                        await db.collection('teachers').add(teacher);
                    }
                }
                console.log('[v0] Default teachers data initialized');
            } catch (error) {
                console.error('[v0] Error initializing default data:', error);
            }
        }

        // YouTube API Functions
        async function getPlaylistVideos(playlistId) {
            try {
                const response = await fetch(
                    `https://www.googleapis.com/youtube/v3/playlistItems?part=snippet&maxResults=50&playlistId=${playlistId}&key=${YOUTUBE_API_KEY}`
                );
                const data = await response.json();
                return data.items || [];
            } catch (error) {
                console.error('[v0] Error fetching playlist videos:', error);
                return [];
            }
        }

        async function getVideoDetails(videoId) {
            try {
                const response = await fetch(
                    `https://www.googleapis.com/youtube/v3/videos?part=snippet,contentDetails&id=${videoId}&key=${YOUTUBE_API_KEY}`
                );
                const data = await response.json();
                return data.items[0] || null;
            } catch (error) {
                console.error('[v0] Error fetching video details:', error);
                return null;
            }
        }

        // Navigation Functions
        function showSubjects() {
            document.getElementById('subjects-section').style.display = 'block';
            document.getElementById('teachers-section').style.display = 'none';
            document.getElementById('videos-section').style.display = 'none';
        }

        async function showTeachers(subject) {
            currentSubject = subject;
            
            const subjectNames = {
                chemistry: 'الكيمياء',
                physics: 'الفيزياء',
                biology: 'الأحياء',
                english: 'اللغة الإنجليزية',
                arabic: 'اللغة العربية'
            };

            document.getElementById('subject-title').textContent = `مدرسو ${subjectNames[subject]}`;
            document.getElementById('subjects-section').style.display = 'none';
            document.getElementById('teachers-section').style.display = 'block';
            document.getElementById('videos-section').style.display = 'none';

            // Load teachers from Firebase
            const teachersGrid = document.getElementById('teachers-grid');
            teachersGrid.innerHTML = '<div class="loading"><i class="fas fa-spinner"></i><br>جاري تحميل المدرسين...</div>';

            try {
                const snapshot = await db.collection('teachers').where('subject', '==', subject).get();
                teachersGrid.innerHTML = '';

                if (snapshot.empty) {
                    teachersGrid.innerHTML = '<p style="text-align: center; color: #718096;">لا يوجد مدرسون لهذه المادة حالياً</p>';
                    return;
                }

                snapshot.forEach(doc => {
                    const teacher = doc.data();
                    const teacherCard = createTeacherCard(teacher, doc.id);
                    teachersGrid.appendChild(teacherCard);
                });
            } catch (error) {
                console.error('[v0] Error loading teachers:', error);
                teachersGrid.innerHTML = '<p style="text-align: center; color: #e53e3e;">حدث خطأ في تحميل البيانات</p>';
            }
        }

        function createTeacherCard(teacher, teacherId) {
            const card = document.createElement('div');
            card.className = 'teacher-card';
            card.onclick = () => showVideos(teacher, teacherId);

            const initials = teacher.name.split(' ').map(n => n[0]).join('').substring(0, 2);

            card.innerHTML = `
                <div class="teacher-avatar">${initials}</div>
                <div class="teacher-name">${teacher.name}</div>
                <div class="teacher-subject">${teacher.description || 'مدرس متميز'}</div>
            `;

            return card;
        }

        async function showVideos(teacher, teacherId) {
            currentTeacher = { ...teacher, id: teacherId };
            
            document.getElementById('teacher-title').textContent = `فيديوهات ${teacher.name}`;
            document.getElementById('teachers-section').style.display = 'none';
            document.getElementById('videos-section').style.display = 'block';

            const videosGrid = document.getElementById('videos-grid');
            videosGrid.innerHTML = '<div class="loading"><i class="fas fa-spinner"></i><br>جاري تحميل الفيديوهات...</div>';

            try {
                let allVideos = [];

                // Handle playlists
                if (teacher.playlists) {
                    for (const playlist of teacher.playlists) {
                        const videos = await getPlaylistVideos(playlist.id);
                        allVideos = allVideos.concat(videos.map(video => ({
                            ...video,
                            playlistTitle: playlist.title
                        })));
                    }
                }

                // Handle single video
                if (teacher.videoId) {
                    const videoDetails = await getVideoDetails(teacher.videoId);
                    if (videoDetails) {
                        allVideos.push({
                            snippet: videoDetails.snippet,
                            contentDetails: videoDetails.contentDetails
                        });
                    }
                }

                videosGrid.innerHTML = '';

                if (allVideos.length === 0) {
                    videosGrid.innerHTML = '<p style="text-align: center; color: #718096;">لا توجد فيديوهات متاحة</p>';
                    return;
                }

                allVideos.forEach(video => {
                    const videoCard = createVideoCard(video);
                    videosGrid.appendChild(videoCard);
                });

            } catch (error) {
                console.error('[v0] Error loading videos:', error);
                videosGrid.innerHTML = '<p style="text-align: center; color: #e53e3e;">حدث خطأ في تحميل الفيديوهات</p>';
            }
        }

        function createVideoCard(video) {
            const card = document.createElement('div');
            card.className = 'video-card';
            
            const videoId = video.snippet.resourceId?.videoId || video.id;
            const thumbnail = video.snippet.thumbnails.medium?.url || video.snippet.thumbnails.default?.url;
            const title = video.snippet.title;
            const duration = formatDuration(video.contentDetails?.duration);
            const playlistTitle = video.playlistTitle ? `من: ${video.playlistTitle}` : '';

            card.onclick = () => openVideoPlayer(video, videoId);

            card.innerHTML = `
                <img src="${thumbnail}" alt="${title}" class="video-thumbnail">
                <div class="video-info">
                    <div class="video-title">${title}</div>
                    ${playlistTitle ? `<div style="color: #667eea; font-size: 0.8rem; margin-bottom: 5px;">${playlistTitle}</div>` : ''}
                    <div class="video-duration">${duration || 'مدة غير محددة'}</div>
                </div>
            `;

            return card;
        }

        function formatDuration(duration) {
            if (!duration) return '';
            
            const match = duration.match(/PT(\d+H)?(\d+M)?(\d+S)?/);
            if (!match) return '';

            const hours = (match[1] || '').replace('H', '');
            const minutes = (match[2] || '').replace('M', '');
            const seconds = (match[3] || '').replace('S', '');

            let formatted = '';
            if (hours) formatted += hours + ':';
            if (minutes) formatted += minutes.padStart(2, '0') + ':';
            if (seconds) formatted += seconds.padStart(2, '0');

            return formatted || 'مدة غير محددة';
        }

        // Initialize the app
        document.addEventListener('DOMContentLoaded', async () => {
            console.log('[v0] Educational platform initialized');
            
            // Load saved settings
            const savedName = localStorage.getItem('platformName');
            const savedDescription = localStorage.getItem('platformDescription');
            
            if (savedName) {
                document.querySelector('.header h1').innerHTML = `<i class="fas fa-graduation-cap"></i> ${savedName}`;
                document.getElementById('platform-name').value = savedName;
            }
            
            if (savedDescription) {
                document.querySelector('.header p').textContent = savedDescription;
                document.getElementById('platform-description').value = savedDescription;
            }
            
            // Check if default data exists, if not initialize it
            try {
                const snapshot = await db.collection('teachers').limit(1).get();
                if (snapshot.empty) {
                    await initializeDefaultData();
                }
            } catch (error) {
                console.error('[v0] Error checking/initializing data:', error);
            }

            // Add search and filter functionality
            document.getElementById('teacher-search')?.addEventListener('input', filterTeachers);
            document.getElementById('subject-filter')?.addEventListener('change', filterTeachers);
        });

        function filterTeachers() {
            const searchTerm = document.getElementById('teacher-search')?.value.toLowerCase() || '';
            const subjectFilter = document.getElementById('subject-filter')?.value || '';
            
            const rows = document.querySelectorAll('#teachers-table-body tr');
            rows.forEach(row => {
                const teacherName = row.cells[3]?.textContent.toLowerCase() || '';
                const teacherSubject = row.cells[2]?.textContent || '';
                
                const matchesSearch = teacherName.includes(searchTerm);
                const matchesSubject = !subjectFilter || teacherSubject.includes(subjectFilter);
                
                row.style.display = matchesSearch && matchesSubject ? '' : 'none';
            });
        }

        // Allow admin login with Enter key
        document.getElementById('admin-password')?.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                adminLogin();
            }
        });

        /* Added advanced features: theme, search, favorites, progress tracking */
        
        // Theme Management
        let isDarkTheme = localStorage.getItem('darkTheme') === 'true';

        function toggleTheme() {
            isDarkTheme = !isDarkTheme;
            document.body.classList.toggle('dark-theme', isDarkTheme);
            document.getElementById('theme-icon').className = isDarkTheme ? 'fas fa-sun' : 'fas fa-moon';
            localStorage.setItem('darkTheme', isDarkTheme);
            showNotification(isDarkTheme ? 'تم تفعيل المظهر الداكن' : 'تم تفعيل المظهر الفاتح');
        }

        // Initialize theme
        if (isDarkTheme) {
            document.body.classList.add('dark-theme');
            document.getElementById('theme-icon').className = 'fas fa-sun';
        }

        // Notification System
        function showNotification(message, type = 'success') {
            const notification = document.getElementById('notification');
            const text = document.getElementById('notification-text');
            
            text.textContent = message;
            notification.className = `notification ${type} show`;
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }

        // Global Search Functionality
        async function performGlobalSearch() {
            const query = document.getElementById('global-search').value.trim();
            if (!query) {
                showNotification('يرجى إدخال كلمة البحث', 'warning');
                return;
            }

            showNotification('جاري البحث...');
            
            try {
                // Search through all teachers and their videos
                const snapshot = await db.collection('teachers').get();
                let searchResults = [];

                for (const doc of snapshot.docs) {
                    const teacher = doc.data();
                    
                    // Search in teacher name
                    if (teacher.name.toLowerCase().includes(query.toLowerCase())) {
                        searchResults.push({
                            type: 'teacher',
                            teacher: teacher,
                            teacherId: doc.id
                        });
                    }

                    // Search in playlists and videos
                    if (teacher.playlists) {
                        for (const playlist of teacher.playlists) {
                            const videos = await getPlaylistVideos(playlist.id);
                            for (const video of videos) {
                                if (video.snippet.title.toLowerCase().includes(query.toLowerCase())) {
                                    searchResults.push({
                                        type: 'video',
                                        video: video,
                                        teacher: teacher,
                                        playlist: playlist
                                    });
                                }
                            }
                        }
                    }
                }

                displaySearchResults(searchResults, query);
                
            } catch (error) {
                console.error('[v0] Search error:', error);
                showNotification('حدث خطأ في البحث', 'error');
            }
        }

        function displaySearchResults(results, query) {
            // Hide other sections
            document.getElementById('subjects-section').style.display = 'none';
            document.getElementById('teachers-section').style.display = 'none';
            document.getElementById('videos-section').style.display = 'none';
            document.getElementById('favorites-section').style.display = 'none';

            // Create or update search results section
            let searchSection = document.getElementById('search-results-section');
            if (!searchSection) {
                searchSection = document.createElement('div');
                searchSection.id = 'search-results-section';
                searchSection.className = 'videos-section';
                document.querySelector('.container').appendChild(searchSection);
            }

            searchSection.style.display = 'block';
            searchSection.innerHTML = `
                <button class="btn btn-secondary back-btn" onclick="hideSearchResults()">
                    <i class="fas fa-arrow-right"></i> العودة
                </button>
                <h2 style="margin-bottom: 25px; color: #2d3748;">
                    نتائج البحث عن: "${query}" (${results.length} نتيجة)
                </h2>
                <div id="search-results-grid" class="videos-grid"></div>
            `;

            const resultsGrid = document.getElementById('search-results-grid');
            
            if (results.length === 0) {
                resultsGrid.innerHTML = '<p style="text-align: center; color: #718096;">لم يتم العثور على نتائج</p>';
                return;
            }

            results.forEach(result => {
                if (result.type === 'video') {
                    const videoCard = createVideoCard(result.video);
                    resultsGrid.appendChild(videoCard);
                } else if (result.type === 'teacher') {
                    const teacherCard = createTeacherCard(result.teacher, result.teacherId);
                    resultsGrid.appendChild(teacherCard);
                }
            });

            showNotification(`تم العثور على ${results.length} نتيجة`);
        }

        function hideSearchResults() {
            document.getElementById('search-results-section').style.display = 'none';
            document.getElementById('subjects-section').style.display = 'block';
        }

        // Favorites Management
        function showFavorites() {
            const favorites = JSON.parse(localStorage.getItem('favorites') || '[]');
            
            // Hide other sections
            document.getElementById('subjects-section').style.display = 'none';
            document.getElementById('teachers-section').style.display = 'none';
            document.getElementById('videos-section').style.display = 'none';
            
            // Show favorites section
            document.getElementById('favorites-section').style.display = 'block';
            
            const favoritesGrid = document.getElementById('favorites-grid');
            
            if (favorites.length === 0) {
                favoritesGrid.innerHTML = '<p style="text-align: center; color: #718096;">لا توجد فيديوهات مفضلة</p>';
                return;
            }

            favoritesGrid.innerHTML = '';
            favorites.forEach(favorite => {
                const card = document.createElement('div');
                card.className = 'video-card animate-fade-in';
                card.onclick = () => openVideoPlayerFromFavorite(favorite);

                card.innerHTML = `
                    <img src="${favorite.thumbnail}" alt="${favorite.title}" class="video-thumbnail">
                    <div class="video-info">
                        <div class="video-title">${favorite.title}</div>
                        <div style="color: #667eea; font-size: 0.8rem; margin-bottom: 5px;">
                            ${favorite.teacher} - ${getSubjectName(favorite.subject)}
                        </div>
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <span class="video-duration">مضاف في ${new Date(favorite.addedAt).toLocaleDateString('ar')}</span>
                            <button onclick="removeFromFavorites('${favorite.videoId}'); event.stopPropagation();" 
                                    style="background: #e53e3e; color: white; border: none; padding: 5px 10px; border-radius: 5px; cursor: pointer;">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                `;
                favoritesGrid.appendChild(card);
            });
        }

        function hideFavorites() {
            document.getElementById('favorites-section').style.display = 'none';
            document.getElementById('subjects-section').style.display = 'block';
        }

        function openVideoPlayerFromFavorite(favorite) {
            // Simulate video object for player
            const video = {
                snippet: {
                    title: favorite.title,
                    thumbnails: { medium: { url: favorite.thumbnail } }
                }
            };
            
            currentTeacher = { name: favorite.teacher };
            currentSubject = favorite.subject;
            
            openVideoPlayer(video, favorite.videoId);
        }

        function removeFromFavorites(videoId) {
            let favorites = JSON.parse(localStorage.getItem('favorites') || '[]');
            favorites = favorites.filter(f => f.videoId !== videoId);
            localStorage.setItem('favorites', JSON.stringify(favorites));
            updateFavoritesCount();
            showFavorites(); // Refresh the display
            showNotification('تم حذف الفيديو من المفضلة');
        }

        function updateFavoritesCount() {
            const favorites = JSON.parse(localStorage.getItem('favorites') || '[]');
            document.getElementById('favorites-count').textContent = favorites.length;
        }

        function getSubjectName(subject) {
            const names = {
                chemistry: 'الكيمياء',
                physics: 'الفيزياء',
                biology: 'الأحياء',
                english: 'اللغة الإنجليزية',
                arabic: 'اللغة العربية'
            };
            return names[subject] || subject;
        }

        // Progress Tracking
        function updateUserStats() {
            const stats = JSON.parse(localStorage.getItem('userStats') || '{"videosWatched": 0, "timeSpent": 0, "achievements": 0}');
            
            document.getElementById('user-videos-watched').textContent = stats.videosWatched;
            document.getElementById('user-time-spent').textContent = stats.timeSpent;
            document.getElementById('user-achievements').textContent = stats.achievements;
            
            // Update daily progress
            const dailyGoal = 30; // 30 minutes daily goal
            const todayTime = getTodayWatchTime();
            const progress = Math.min((todayTime / dailyGoal) * 100, 100);
            
            document.getElementById('daily-progress').style.width = progress + '%';
            document.getElementById('daily-goal').textContent = `${todayTime}/${dailyGoal}`;
            
            // Update achievements
            updateAchievements(stats);
        }

        function getTodayWatchTime() {
            const today = new Date().toDateString();
            const dailyStats = JSON.parse(localStorage.getItem('dailyStats') || '{}');
            return dailyStats[today] || 0;
        }

        function addWatchTime(minutes) {
            const today = new Date().toDateString();
            const dailyStats = JSON.parse(localStorage.getItem('dailyStats') || '{}');
            dailyStats[today] = (dailyStats[today] || 0) + minutes;
            localStorage.setItem('dailyStats', JSON.stringify(dailyStats));
            
            const userStats = JSON.parse(localStorage.getItem('userStats') || '{"videosWatched": 0, "timeSpent": 0, "achievements": 0}');
            userStats.timeSpent += minutes;
            userStats.videosWatched += 1;
            localStorage.setItem('userStats', JSON.stringify(userStats));
            
            updateUserStats();
        }

        function updateAchievements(stats) {
            const badges = document.getElementById('user-badges');
            badges.innerHTML = '';
            
            const achievements = [];
            
            if (stats.videosWatched >= 10) achievements.push('مشاهد نشط');
            if (stats.videosWatched >= 50) achievements.push('عاشق التعلم');
            if (stats.timeSpent >= 300) achievements.push('متعلم مثابر');
            if (getTodayWatchTime() >= 30) achievements.push('هدف اليوم');
            
            achievements.forEach(achievement => {
                const badge = document.createElement('span');
                badge.className = 'achievement-badge';
                badge.textContent = achievement;
                badges.appendChild(badge);
            });
            
            // Update achievements count
            const userStats = JSON.parse(localStorage.getItem('userStats') || '{"videosWatched": 0, "timeSpent": 0, "achievements": 0}');
            userStats.achievements = achievements.length;
            localStorage.setItem('userStats', JSON.stringify(userStats));
        }

        // Enhanced video player with tracking
        function openVideoPlayer(video, videoId) {
            currentVideo = { ...video, videoId };
            
            // Track video views and add watch time
            let totalViews = parseInt(localStorage.getItem('totalViews') || '0');
            totalViews++;
            localStorage.setItem('totalViews', totalViews.toString());
            
            // Add estimated watch time (assume 10 minutes per video)
            addWatchTime(10);
            
            const modal = document.getElementById('video-player-modal');
            const iframe = document.getElementById('video-iframe');
            const title = document.getElementById('video-player-title');
            const teacherName = document.getElementById('video-teacher-name');
            const subjectName = document.getElementById('video-subject-name');
            const playlistName = document.getElementById('video-playlist-name');
            
            // Set video details
            title.textContent = video.snippet.title;
            teacherName.textContent = currentTeacher?.name || 'غير محدد';
            
            const subjectNames = {
                chemistry: 'الكيمياء',
                physics: 'الفيزياء',
                biology: 'الأحياء',
                english: 'اللغة الإنجليزية',
                arabic: 'اللغة العربية'
            };
            subjectName.textContent = subjectNames[currentSubject] || 'غير محدد';
            playlistName.textContent = video.playlistTitle || 'فيديو منفرد';
            
            // Set iframe source with autoplay
            iframe.src = `https://www.youtube.com/embed/${videoId}?autoplay=1&rel=0&modestbranding=1`;
            
            // Show modal
            modal.style.display = 'block';
            document.body.style.overflow = 'hidden';
            
            showNotification('تم فتح الفيديو');
        }

        // Floating Menu Functions
        function scrollToTop() {
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function showQuickStats() {
            const stats = JSON.parse(localStorage.getItem('userStats') || '{"videosWatched": 0, "timeSpent": 0, "achievements": 0}');
            const favorites = JSON.parse(localStorage.getItem('favorites') || '[]');
            
            alert(`إحصائياتك السريعة:\n\n` +
                  `📹 الفيديوهات المشاهدة: ${stats.videosWatched}\n` +
                  `⏱️ الوقت المقضي: ${stats.timeSpent} دقيقة\n` +
                  `❤️ المفضلة: ${favorites.length}\n` +
                  `🏆 الإنجازات: ${stats.achievements}`);
        }

        function showHelp() {
            alert(`مرحباً بك في منصة التعليم الإلكتروني!\n\n` +
                  `🎯 كيفية الاستخدام:\n` +
                  `• اختر المادة من الصفحة الرئيسية\n` +
                  `• اختر المدرس المناسب\n` +
                  `• شاهد الفيديوهات واستمتع بالتعلم\n\n` +
                  `✨ الميزات المتقدمة:\n` +
                  `• البحث الشامل في جميع الفيديوهات\n` +
                  `• إضافة الفيديوهات للمفضلة\n` +
                  `• تتبع التقدم والإنجازات\n` +
                  `• المظهر الداكن والفاتح\n\n` +
                  `📞 للمساعدة: تواصل مع الإدارة`);
        }

        // Network Status Detection
        function updateOnlineStatus() {
            const indicator = document.getElementById('offline-indicator');
            if (navigator.onLine) {
                indicator.style.display = 'none';
            } else {
                indicator.style.display = 'block';
                showNotification('تم فقدان الاتصال بالإنترنت', 'error');
            }
        }

        window.addEventListener('online', updateOnlineStatus);
        window.addEventListener('offline', updateOnlineStatus);

        // Enhanced search with Enter key
        document.getElementById('global-search')?.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                performGlobalSearch();
            }
        });

        // Initialize advanced features
        document.addEventListener('DOMContentLoaded', async () => {
            console.log('[v0] Educational platform with advanced features initialized');
            
            // Initialize all advanced features
            updateFavoritesCount();
            updateUserStats();
            updateOnlineStatus();
            
            // Add animation classes to elements
            document.querySelectorAll('.subject-card, .teacher-card, .video-card').forEach((el, index) => {
                setTimeout(() => {
                    el.classList.add('animate-fade-in');
                }, index * 100);
            });
            
            // Load saved settings
            const savedName = localStorage.getItem('platformName');
            const savedDescription = localStorage.getItem('platformDescription');
            
            if (savedName) {
                document.querySelector('.header h1').innerHTML = `<i class="fas fa-graduation-cap"></i> ${savedName}`;
                document.getElementById('platform-name').value = savedName;
            }
            
            if (savedDescription) {
                document.querySelector('.header p').textContent = savedDescription;
                document.getElementById('platform-description').value = savedDescription;
            }
            
            // Check if default data exists, if not initialize it
            try {
                const snapshot = await db.collection('teachers').limit(1).get();
                if (snapshot.empty) {
                    await initializeDefaultData();
                }
            } catch (error) {
                console.error('[v0] Error checking/initializing data:', error);
            }

            // Add search and filter functionality
            document.getElementById('teacher-search')?.addEventListener('input', filterTeachers);
            document.getElementById('subject-filter')?.addEventListener('change', filterTeachers);
        });

    </script>
</body>
</html>
